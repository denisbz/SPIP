#HTTP_HEADER{"Cache-Control: no-store, no-cache, must-revalidate"}
#HTTP_HEADER{"Pragma: no-cache"}

[(#ENV{echec_cookie})
<fieldset class="reponse_formulaire">
<legend><:avis_erreur_cookie:></legend>
<p><:login_cookie_oblige:></p>
<p><:login_cookie_accepte:></p>
</fieldset>]

[(#ENV{echec_visiteur})
<fieldset class="reponse_formulaire">
<legend><:avis_erreur_visiteur:></legend>
<p><:texte_erreur_visiteur:></p>
</fieldset>]

	<script type="text/javascript" src="#EVAL{_DIR_JAVASCRIPT}md5.js"> </script>
	[<script type="text/javascript">
	var alea_actuel="(#ENV{alea_actuel})";
	var alea_futur="[(#ENV{alea_futur})]";
	</script>]
	<form id="login[_(#ENV{login})]"
		action="[(#ENV{action2})]"
		method="post"[(#ENV{source}|=={spip}|?{' ',''})
		onsubmit='if (this.session_password.value) {
			this.session_password_md5.value = calcMD5(alea_actuel + this.session_password.value);
			this.next_session_password_md5.value = calcMD5(alea_futur + this.session_password.value);
			this.session_password.value = "";
			return true;
			}']>
	<fieldset>
	<legend><:form_forum_identifiants:></legend>
		[<p class="reponse_formulaire">(#ENV*{erreur})</p>]
		[<p><label for="var_login"><:login_login2:></label>(#ENV{login}|?{'',' '})<br />
		<input type="text" class="forml" id="var_login" name="var_login" value="" size="40" /></p>]
		
[
[(#LOGO_AUTEUR||reduire_image{100,80}|inserer_attribut{alt,#ENV{login_alt}})]
<input type="hidden" name="session_login_hidden" value="(#ENV{login})" />
<script type="text/javascript"><!--
document.write("<p><:login_login:>&nbsp;<strong>[(#ENV{login_alt})]<" + "/strong><br />&#91;<a href='[(#ENV{action2}
	|parametre_url{cookie_admin,non}
	|parametre_url{url,#ENV*{url}}
	|parametre_url{retour,#ENV*{self}})]'><:login_autre_identifiant:><" + "/a>&#93;</p>")
//--></script>
<noscript>
	<p class="reponse_formulaire"><:login_non_securise:> <a href="[(#ENV{action})]"><:login_recharger:></a>.</p>
	<p><label for="session_login"><:login_login2:></label><br />
	<input type="text" class="forml" name="session_login" id="session_login"[ value="(#ENV{login})"] size="40" /></p>
</noscript>
]
	[(#ENV{login}|?{'',' '})<div id='pass_ajax' style='display:none;'>]
	<p><label[ for="var_login_(#ENV{login})"]><:login_pass2:></label><br />
	<input type="password" class="forml" name="session_password"[ id="var_login_(#ENV{login})"] value="" size="20" /></p>

[(#ENV{rester_connecte})
	<p><input type="checkbox" name="session_remember" id="session[_(#ENV{login})]" value="oui"[(#ENV*{prefs}|filtre_rester_connecte)checked="checked"]/>
	<label for="session[_(#ENV{login})]"><:login_rester_identifie:></label></p>
]
	[(#ENV{login}|?{'',' '})</div>]
	<input type="hidden" name="session_password_md5" value="" />
	<input type="hidden" name="next_session_password_md5" value="" />
	<input type="hidden" name="essai_login" value="oui" />
	<input type="hidden" name="url" value="[(#ENV{url})]" />
	<p class="spip_bouton"><input type="submit" value="<:bouton_valider:>" /></p>
	</fieldset>
	</form>
<script type="text/javascript"><!--
document.getElementById('var_login[_(#ENV{login})]').focus();
--></script>[
	<form action="(#ENV{auth_http})" method="get">[
	(#ENV{auth_http}|form_hidden)
	]
	<fieldset>
	<legend><:login_sans_cookiie:></legend>
	<div><:login_preferez_refuser:>
	<input type="hidden" name="essai_auth_http" value="oui"/>
	[<input type="hidden" name="url" value="(#ENV{url})"/>]
	<p class="spip_bouton"><input type="submit" value="<:login_sans_cookiie:>"/></p></div>
	</fieldset>
	</form>
]
[(#ENV{login}|?{'',' '})
<script type='text/javascript' src='#URL_PAGE{jquery.js}'></script>
<script type='text/javascript'>
var alea_actuel;
var alea_futur;
$('#pass_ajax').show().after('<input type="hidden" name="session_login_hidden" id="session_login_hidden" value="" />');
$('#var_login').blur(function(){
  $.get('#URL_ACTION{aleer}',
    {var_login:$(this).attr('value')},
    function (c) {
      eval('c = '+c); // JSON	
      alea_actuel = c.alea_actuel;
      alea_futur = c.alea_futur;
			$('input#session_login_hidden').attr('value',c.login);
			$('input#session').attr('checked',c.cnx=='1'?'checked':'');
    });
});
$('form#login').submit(function(){
	pass = $('input#EVAL{chr(91)}@name=session_password#EVAL{chr(93)}').attr('value');
	// ne jamais laisser le pass circuler en clair
	$('input#EVAL{chr(91)}@name=session_password#EVAL{chr(93)}').attr('value','');
	if (pass) {
		if (alea_actuel!=undefined) {
			$(this).attr('action','#ENV{pose_cookie}');
			$('input#EVAL{chr(91)}@name=session_password_md5#EVAL{chr(93)}').attr('value',calcMD5(alea_actuel + pass));
			$('input#EVAL{chr(91)}@name=next_session_password_md5#EVAL{chr(93)}').attr('value',calcMD5(alea_futur + pass));
		}
	}
});
</script>
]
